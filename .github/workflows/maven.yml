jobs:
  build:
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      uses: actions/checkout@v2
    - continue-on-error: true
      name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        distribution: Liberica
        java-package: jdk+fx
        java-version: 1.8
    - continue-on-error: true
      name: Build with Maven
      run: mvn clean package -DskipTests=true -Dmaven.javadoc.skip=true -B -V
    - continue-on-error: true
      env:
        GITHUB_TOKEN: ${{ secrets.RELEASE }}
      id: create_release
      name: Create Release
      uses: SummerSec/create-release@master
      with:
        draft: false
        prerelease: false
        release-name: Release ${{ github.ref }}
        tag_name: ${{ github.ref }}
    - continue-on-error: true
      id: upload-build-artifact
      name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.3.1
      with:
        name: SPATool-${{steps.create_release.outputs.tag}}-SNAPSHOT-all.jar
        path: target/*-SNAPSHOT-all.jar
    - continue-on-error: true
      env:
        GITHUB_TOKEN: ${{secrets.RELEASE}}
      id: upload-release-asset
      name: Auto Upload Release
      uses: actions/upload-release-asset@v1.0.1
      with:
        asset_content_type: application/java-archive
        asset_name: SpringBootExploit-${{ steps.create_release.outputs.tag }}-SNAPSHOT-all.jar
        asset_path: /home/runner/work/SpringBootExploit/SpringBootExploit/target/SpringBootExploit-${{
          steps.create_release.outputs.tag }}-SNAPSHOT-all.jar
        upload_url: ${{ steps.create_release.outputs.upload_url }}
name: Release Maven
on:
  repository_dispatch:
    types: trigger-ga___maven.yml
